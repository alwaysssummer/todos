# 🔄 루틴(Routine) 기능 개발 플랜

## 📋 개요
매일 반복적으로 체크하고 기록해야 할 것들을 관리하는 독립적인 기능

---

## 🎯 핵심 원칙
1. **완전 독립적** - Task/Project와 데이터 연동 없음
2. **기존 UI 활용** - 레이아웃, 스타일, 컴포넌트 재사용
3. **심플함** - 최소한의 속성으로 직관적 사용

---

## 📊 데이터 구조

### Routine (루틴 정의)
| 필드 | 타입 | 설명 |
|------|------|------|
| id | UUID | 고유 ID |
| title | TEXT | 루틴 제목 |
| repeat_days | INTEGER[] | 반복 요일 [0-6], 기본값 매일 |
| target_time | TEXT | 목표 시간 (선택) |
| is_active | BOOLEAN | 활성화 여부 |
| order_index | INTEGER | 정렬 순서 |
| created_at | TIMESTAMPTZ | 생성일 |

### RoutineLog (일별 기록)
| 필드 | 타입 | 설명 |
|------|------|------|
| id | UUID | 고유 ID |
| routine_id | UUID | 루틴 ID (FK) |
| date | DATE | 날짜 |
| is_completed | BOOLEAN | 완료 여부 |
| completed_at | TIMESTAMPTZ | 완료 시간 |
| note | TEXT | 메모 (선택) |
| created_at | TIMESTAMPTZ | 생성일 |

---

## 🎨 UI 배치

```
┌─────────────────────────────────┐
│  🔄 ROUTINES            [+]    │  ← 최상단 (새로 추가)
├─────────────────────────────────┤
│  ☐ 운동하기              [📝]  │
│  ☑ 영어 공부             [📝]  │
└─────────────────────────────────┘
│  Today's Focus                  │  ← 기존
│  Today's Task                   │  ← 기존
│  PROJECT                        │  ← 기존
│  INBOX                          │  ← 기존
│  ...                            │
```

---

## 📁 파일 구조

```
types/
  └── database.ts          # Routine, RoutineLog 타입 추가

hooks/
  └── useRoutines.ts       # 루틴 CRUD + 로그 관리 + 통계

components/
  └── RoutineSection.tsx   # 루틴 섹션 컴포넌트
  └── RoutineModal.tsx     # 루틴 생성/수정 모달
  └── RoutineStatsModal.tsx # 통계 모달 (Phase 3)

supabase_routines.sql      # 테이블 생성 SQL
```

---

## 🚀 개발 Phase

### Phase 1: 기본 구조 (Day 1)
- [x] 브랜치 생성
- [ ] Supabase 테이블 SQL 작성
- [ ] 타입 정의 (types/database.ts)
- [ ] useRoutines 훅 기본 구조

### Phase 2: UI 구현 (Day 1-2)
- [ ] RoutineSection 컴포넌트
  - [ ] 루틴 목록 표시
  - [ ] 체크박스 (완료 토글)
  - [ ] 드래그 앤 드롭 (순서 변경)
- [ ] RoutineModal (생성/수정)
  - [ ] 제목 입력
  - [ ] 요일 선택 UI
  - [ ] 목표 시간 (선택)

### Phase 3: 기록 기능 (Day 2)
- [ ] 일별 로그 자동 생성 로직
- [ ] 메모 입력 기능 (📝 버튼)
- [ ] 자정 기준 초기화 로직

### Phase 4: 통계 (Day 3)
- [ ] RoutineStatsModal
  - [ ] 주간 달성률
  - [ ] 월간 달성률
  - [ ] 연속 달성일 (스트릭)
  - [ ] 총 달성 횟수

---

## 🔧 활용할 기존 요소

| 기존 요소 | 루틴에서 활용 |
|----------|--------------|
| 체크박스 스타일 | 루틴 완료 체크 |
| 박스 스타일 (shadow, border) | 루틴 아이템 |
| GripVertical 아이콘 | 드래그 핸들 |
| + 버튼 스타일 | 루틴 추가 |
| 모달 컴포넌트 | 생성/수정/통계 |
| Pencil 아이콘 | 인라인 편집 |

---

## 📝 동작 흐름

### 1. 루틴 표시 조건
```
오늘 요일이 repeat_days에 포함되면 → 표시
is_active가 true면 → 표시
```

### 2. 체크 동작
```
체크박스 클릭 →
  1. 오늘 날짜의 RoutineLog 조회/생성
  2. is_completed = true, completed_at = now()
  3. UI 업데이트 (회색/취소선)
```

### 3. 자정 초기화
```
페이지 로드 시 →
  1. 오늘 날짜 확인
  2. 오늘의 RoutineLog가 없으면 생성
  3. 새로운 날의 체크 상태로 표시
```

---

## ⚠️ 주의사항

1. **Task와 혼동 금지** - 완전히 별개 시스템
2. **드래그 범위** - 루틴끼리만 순서 변경
3. **데이터 보존** - 루틴 삭제 시 로그는 보관? (확인 필요)

---

## 📅 예상 일정

| Phase | 예상 시간 | 내용 |
|-------|----------|------|
| Phase 1 | 1시간 | 기본 구조 |
| Phase 2 | 2시간 | UI 구현 |
| Phase 3 | 1시간 | 기록 기능 |
| Phase 4 | 1시간 | 통계 |
| **총** | **5시간** | |

---

## ✅ 구현 완료

### Phase 1: 기본 구조 ✅
- [x] Supabase SQL 작성 (`supabase_routines.sql`)
- [x] 타입 정의 (`types/database.ts`)
- [x] useRoutines 훅 (`hooks/useRoutines.ts`)

### Phase 2: UI 구현 ✅
- [x] RoutineSection 컴포넌트 (`components/RoutineSection.tsx`)
- [x] 체크박스 (완료 토글)
- [x] 드래그 앤 드롭 (순서 변경)
- [x] LeftPanel에 통합

### Phase 3: 기록 기능 ✅
- [x] 일별 로그 자동 생성 (체크 시)
- [x] 메모 입력 기능 (📝 버튼)

### Phase 4: 통계 ✅
- [x] 주간/월간 달성률
- [x] 연속 달성일 (스트릭)
- [x] 통계 모달

---

## 🚀 사용 방법

### 1. Supabase 테이블 생성
`supabase_routines.sql` 파일의 SQL을 Supabase SQL Editor에서 실행하세요.

### 2. 페이지 새로고침
테이블 생성 후 페이지를 새로고침하면 ROUTINES 섹션이 표시됩니다.

---

*작성일: 2025-11-25*
*구현 완료: 2025-11-25*

